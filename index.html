<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultimate London Travel Guide & Chatbot üá¨üáß</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    :root {
      --primary-color: #1d3557;
      --secondary-color: #457b9d;
      --accent-color: #e63946;
      --background-light: #f1faee;
      --text-color: #293241;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--background-light);
      color: var(--text-color);
    }

    header {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
                  url('https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?ixlib=rb-1.2.1&auto=format&fit=crop&w=1500&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: white;
      padding: 120px 20px;
      text-align: center;
    }

    .hero-content {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-size: 4rem;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .subtitle {
      font-size: 1.5rem;
      font-weight: 300;
      margin-top: 20px;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 2rem;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      margin-top: 2rem;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .feature-section {
      background: white;
      padding: 3rem 0;
      margin: 2rem 0;
      border-radius: 20px;
    }

    .btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 12px 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      margin: 5px;
    }

    .btn:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
    }

    .example-questions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 1.5rem 0;
    }

    .weather-widget {
      background: linear-gradient(135deg, #00b4db, #0083b0);
      color: white;
      padding: 1.5rem;
      border-radius: 15px;
      margin-top: 20px;
    }

    .currency-converter {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .currency-converter input,
    .currency-converter select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }

    .attractions-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 2rem;
    }

    .attraction-card {
      position: relative;
      height: 250px;
      border-radius: 15px;
      overflow: hidden;
      cursor: pointer;
    }

    .attraction-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .attraction-card:hover img {
      transform: scale(1.1);
    }

    .attraction-info {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 15px;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
    }

    #mapid {
      height: 500px;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin: 2rem 0;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    footer {
      background-color: var(--primary-color);
      color: white;
      padding: 3rem 0;
      margin-top: 3rem;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .social-links {
      display: flex;
      gap: 15px;
      margin-top: 1rem;
    }

    .social-links a {
      color: white;
      font-size: 1.5rem;
      transition: color 0.3s ease;
    }

    .social-links a:hover {
      color: var(--accent-color);
    }

    .notification-badge {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent-color);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: none;
      z-index: 1000;
    }

    .loading-animation {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .map-controls {
      margin-bottom: 1rem;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .map-legend {
      background: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      display: flex;
      justify-content: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .attraction-popup {
      text-align: center;
      max-width: 300px;
    }

    .attraction-popup img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .attraction-popup .live-info {
      margin: 10px 0;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 5px;
    }

    .attraction-popup .wait-time {
      font-weight: bold;
      color: var(--primary-color);
    }

    .real-time-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 15px 0;
    }

    .info-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-card h4 {
      margin: 0 0 10px 0;
      color: var(--primary-color);
    }

    .tube-line {
      display: flex;
      align-items: center;
      margin: 5px 0;
      font-size: 14px;
    }

    .tube-line .status {
      margin-left: 10px;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .status.good {
      background: #4CAF50;
      color: white;
    }

    .status.delayed {
      background: #FFC107;
      color: black;
    }

    .status.disrupted {
      background: #F44336;
      color: white;
    }

    .tripadvisor-rating {
      background: #00af87;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      display: inline-block;
    }

    .weather-brief {
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
    }

    .weather-brief h4 {
      color: white;
      margin-bottom: 15px;
    }

    .weather-content {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 15px;
      align-items: center;
    }

    .weather-temp {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 0;
    }

    .weather-icon {
      font-size: 3rem;
      margin-right: 15px;
    }

    .weather-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
      font-size: 0.9rem;
    }

    .weather-detail {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-small {
      padding: 8px 15px;
      font-size: 0.9rem;
    }

    .weather-location {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    .weather-time {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 5px;
    }

    .weather-alert {
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .tips-container {
      display: grid;
      gap: 15px;
    }

    .tip-item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: start;
      padding: 10px;
      border-radius: 8px;
      background: rgba(0,0,0,0.03);
    }

    .tip-item i {
      font-size: 1.5rem;
      color: var(--primary-color);
      padding-top: 5px;
    }

    .tip-item strong {
      display: block;
      margin-bottom: 5px;
    }

    .tip-item p {
      margin: 0;
      font-size: 0.9rem;
      color: #666;
    }

    .conversion-history {
      margin-top: 10px;
      font-size: 0.9rem;
      max-height: 100px;
      overflow-y: auto;
    }

    .conversion-item {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }

    .live-insights {
      background: white;
      border-radius: 10px;
    }

    .insight-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .tab-btn {
      background: none;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: var(--primary-color);
      color: white;
    }

    .insight-content {
      padding: 15px;
      background: rgba(0,0,0,0.02);
      border-radius: 8px;
    }

    .map-marker {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      color: white;
      font-size: 16px;
    }

    .hotel-marker {
      background: #4CAF50;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    .restaurant-marker {
      background: #FF5722;
      box-shadow: 0 0 10px rgba(255, 87, 34, 0.5);
    }

    .attraction-marker {
      background: #2196F3;
      box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
    }
  </style>
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
</head>
<body>
  <header>
    <div class="hero-content">
      <h1>üåÜ London Explorer</h1>
      <p class="subtitle">Your AI-Powered Guide to the City</p>
      <button class="btn" onclick="scrollToSection('features')">Start Exploring</button>
    </div>
  </header>

  <div class="container">
    <section id="features" class="feature-section">
      <h2>üéØ Quick Access</h2>
      <div class="example-questions">
        <button class="btn" onclick="askExample('What are the top 5 must-visit attractions in London?')">Top Attractions</button>
        <button class="btn" onclick="askExample('How much is an Oyster card and where can I buy it?')">Transport Guide</button>
        <button class="btn" onclick="askExample('What\'s the weather like in London today?')">Weather Update</button>
        <button class="btn" onclick="askExample('Best afternoon tea spots in London?')">Food & Dining</button>
        <button class="btn" onclick="askExample('Free things to do in London this weekend')">Free Activities</button>
        <button class="btn" onclick="askExample('Hidden gems in London')">Hidden Gems</button>
        <button class="btn" onclick="askExample('Best photo spots in London')">Photo Spots</button>
        <button class="btn" onclick="askExample('London nightlife guide')">Nightlife</button>
      </div>
    </section>

    <div class="grid-container">
      <div class="card">
        <h3>üå¶Ô∏è Live Weather</h3>
        <div class="weather-widget">
          <div id="weather-info">
            <h4>Current London Weather</h4>
            <button class="btn" onclick="getWeather()">
              <span id="weather-loading" class="loading-animation" style="display: none;"></span>
              <span id="weather-text">Check Weather</span>
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>üí∑ Currency Converter</h3>
        <div class="currency-converter">
          <input type="number" id="amount" placeholder="Amount" class="form-control">
          <select id="from-currency" class="form-control">
            <option value="USD">USD - US Dollar</option>
            <option value="EUR">EUR - Euro</option>
            <option value="JPY">JPY - Japanese Yen</option>
            <option value="AUD">AUD - Australian Dollar</option>
            <option value="CAD">CAD - Canadian Dollar</option>
            <option value="CHF">CHF - Swiss Franc</option>
            <option value="CNY">CNY - Chinese Yuan</option>
            <option value="HKD">HKD - Hong Kong Dollar</option>
            <option value="NZD">NZD - New Zealand Dollar</option>
            <option value="SEK">SEK - Swedish Krona</option>
            <option value="KRW">KRW - South Korean Won</option>
            <option value="SGD">SGD - Singapore Dollar</option>
            <option value="NOK">NOK - Norwegian Krone</option>
            <option value="MXN">MXN - Mexican Peso</option>
            <option value="INR">INR - Indian Rupee</option>
            <option value="RUB">RUB - Russian Ruble</option>
            <option value="ZAR">ZAR - South African Rand</option>
            <option value="TRY">TRY - Turkish Lira</option>
            <option value="BRL">BRL - Brazilian Real</option>
            <option value="TWD">TWD - Taiwan Dollar</option>
            <option value="DKK">DKK - Danish Krone</option>
            <option value="PLN">PLN - Polish Z≈Çoty</option>
            <option value="THB">THB - Thai Baht</option>
            <option value="IDR">IDR - Indonesian Rupiah</option>
            <option value="HUF">HUF - Hungarian Forint</option>
          </select>
          <button class="btn" onclick="convertCurrency()">Convert to GBP</button>
          <div id="conversion-history" class="conversion-history"></div>
        </div>
      </div>

      <div class="card">
        <h3>üé´ Essential Tips</h3>
        <div class="tips-container">
          <div class="tip-item">
            <i class="fas fa-subway"></i>
            <div>
              <strong>Transport Smart Card</strong>
              <p>Get an Oyster card or use contactless payment. Daily cap applies for best value.</p>
            </div>
          </div>
          <div class="tip-item">
            <i class="fas fa-clock"></i>
            <div>
              <strong>Museum Timings</strong>
              <p>Most museums are free and less crowded during weekday mornings.</p>
            </div>
          </div>
          <div class="tip-item">
            <i class="fas fa-mobile-alt"></i>
            <div>
              <strong>Essential Apps</strong>
              <p>Download Citymapper for navigation and TfL Go for tube updates.</p>
            </div>
          </div>
          <div class="tip-item">
            <i class="fas fa-umbrella"></i>
            <div>
              <strong>Weather Ready</strong>
              <p>Always carry a compact umbrella, London weather can be unpredictable.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>üìä Live Insights</h3>
        <div id="live-insights" class="live-insights">
          <div class="insight-tabs">
            <button class="tab-btn active" onclick="showInsight('crowd')">üë• Crowd Levels</button>
            <button class="tab-btn" onclick="showInsight('satisfaction')">‚≠ê Ratings</button>
            <button class="tab-btn" onclick="showInsight('prices')">üí∞ Price Trends</button>
          </div>
          <div id="insight-content" class="insight-content">Loading insights...</div>
        </div>
      </div>
    </div>

    <section class="feature-section">
      <h2>üìç Interactive London Map</h2>
      <div class="map-controls">
        <button class="btn" onclick="toggleMapLayer('tube')">üöá Tube Status</button>
        <button class="btn" onclick="toggleMapLayer('traffic')">üöó Live Traffic</button>
        <button class="btn" onclick="toggleMapLayer('crowds')">üë• Crowd Levels</button>
        <button class="btn" onclick="toggleMapLayer('restaurants')">üçΩÔ∏è Restaurants</button>
        <button class="btn" onclick="toggleMapLayer('hotels')">üè® Hotels</button>
        <button class="btn" onclick="centerMap()">üéØ Center Map</button>
      </div>
      <div class="map-legend">
        <div class="legend-item">
          <span class="legend-dot" style="background: #4CAF50;"></span> Hotels
          <span class="legend-dot" style="background: #FF5722;"></span> Restaurants
          <span class="legend-dot" style="background: #2196F3;"></span> Attractions
        </div>
      </div>
      <div class="real-time-info">
        <div class="info-card weather-brief london-weather">
          <h4>üå§Ô∏è London Weather</h4>
          <div id="london-weather-content">
            <div class="weather-details">
              <div class="weather-detail">
                <i class="fas fa-sun"></i> Sunrise: <span id="sunrise-time">Loading...</span>
              </div>
              <div class="weather-detail">
                <i class="fas fa-moon"></i> Sunset: <span id="sunset-time">Loading...</span>
              </div>
            </div>
          </div>
        </div>
        <div class="info-card weather-brief your-weather">
          <h4>üìç Your Local Weather</h4>
          <div id="local-weather-content">
            <div class="weather-details">
              <div class="weather-detail">
                <i class="fas fa-sun"></i> Sunrise: <span id="local-sunrise-time">Loading...</span>
              </div>
              <div class="weather-detail">
                <i class="fas fa-moon"></i> Sunset: <span id="local-sunset-time">Loading...</span>
              </div>
            </div>
          </div>
        </div>
        <div class="info-card transport-brief">
          <h4>üöá Tube Status</h4>
          <div id="tube-brief-content">Loading...</div>
        </div>
      </div>
      <div id="mapid"></div>
    </section>

    <section class="feature-section">
      <h2>üìä London at a Glance</h2>
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-number" id="visitors-count">19.6M</div>
          <p>Annual Visitors</p>
        </div>
        <div class="stat-card">
          <div class="stat-number">270+</div>
          <p>Underground Stations</p>
        </div>
        <div class="stat-card">
          <div class="stat-number">3,000+</div>
          <p>Parks and Green Spaces</p>
        </div>
        <div class="stat-card">
          <div class="stat-number">170+</div>
          <p>Museums</p>
        </div>
      </div>
    </section>

    <section class="feature-section">
      <h2>üì∏ Must-Visit Attractions</h2>
      <div class="attractions-grid">
        <div class="attraction-card" onclick="showAttractionDetails('Tower Bridge')">
          <img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad" alt="Tower Bridge">
          <div class="attraction-info">
            <h4>Tower Bridge</h4>
            <p>London's iconic bridge</p>
          </div>
        </div>
        <div class="attraction-card" onclick="showAttractionDetails('London Eye')">
          <img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad" alt="London Eye">
          <div class="attraction-info">
            <h4>London Eye</h4>
            <p>Best views of the city</p>
          </div>
        </div>
        <div class="attraction-card" onclick="showAttractionDetails('Big Ben')">
          <img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad" alt="Big Ben">
          <div class="attraction-info">
            <h4>Big Ben</h4>
            <p>Historic clocktower</p>
          </div>
        </div>
      </div>
    </section>
  </div>
  <df-messenger
  intent="WELCOME"
  chat-title="LondonTourismBot"
  agent-id="19787e79-c4bb-4fd5-bdff-85dedd2de68d"
  language-code="en"
  environment="web"
></df-messenger>


  <div class="notification-badge" id="notification">
    <span id="notification-text"></span>
  </div>

  <footer>
    <div class="footer-content">
      <div>
        <h3>London Travel Guide</h3>
        <p>Your ultimate companion for exploring London</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
      <div>
        <h4>Quick Links</h4>
        <ul>
          <li><a href="#features">Features</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
      <div>
        <h4>Contact Us</h4>
        <p>Email: info@londontravelguide.com</p>
        <p>Phone: +44 20 1234 5678</p>
      </div>
    </div>
  </footer>

  <script>
    // Initialize map and layer variables
    let map;
    let trafficLayer, tubeLayer, crowdsLayer, restaurantsLayer, hotelsLayer;
    let currentMapLayer = 'default';

    // Initialize map when document is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize map
      map = L.map('mapid').setView([51.5074, -0.1278], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // Initialize other features
      initializeRealTimeInfo();
      showInsight('crowd');
      updateWeatherInfo();
    });

    // Enhanced askExample function with loading state
    function askExample(question) {
      const dfMessenger = document.querySelector("df-messenger");
      showNotification("Sending your question...");
      setTimeout(() => {
        try {
          const messenger = dfMessenger.shadowRoot.querySelector("df-messenger-chat");
          const userInput = messenger.shadowRoot.querySelector("df-messenger-user-input");
          const input = userInput.shadowRoot.querySelector("input");
          input.value = question;
          input.dispatchEvent(new Event("input", { bubbles: true }));
          const sendButton = userInput.shadowRoot.querySelector("button");
          sendButton.click();
        } catch (err) {
          showNotification("‚ùå Couldn't send message. Please try again.");
        }
      }, 1000);
    }

    // Enhanced weather function with loading state and detailed information
    async function getWeather() {
      const loadingSpinner = document.getElementById('weather-loading');
      const weatherText = document.getElementById('weather-text');
      loadingSpinner.style.display = 'inline-block';
      weatherText.style.display = 'none';

      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&appid=${config.OPENWEATHER_API_KEY}`);
        const data = await response.json();
        
        const temp = Math.round(data.main.temp);
        const desc = data.weather[0].description;
        const feels = Math.round(data.main.feels_like);
        const humidity = data.main.humidity;
        const wind = data.wind.speed;
        const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString();
        const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString();

        Swal.fire({
          title: 'üå§Ô∏è London Weather',
          html: `
            <div style="text-align: left">
              <p><b>üå°Ô∏è Temperature:</b> ${temp}¬∞C (feels like ${feels}¬∞C)</p>
              <p><b>‚òÅÔ∏è Condition:</b> ${desc}</p>
              <p><b>üíß Humidity:</b> ${humidity}%</p>
              <p><b>üí® Wind Speed:</b> ${wind} m/s</p>
              <p><b>üåÖ Sunrise:</b> ${sunrise}</p>
              <p><b>üåá Sunset:</b> ${sunset}</p>
            </div>
          `,
          icon: 'info',
          confirmButtonText: 'Got it!',
          confirmButtonColor: '#1d3557'
        });
      } catch (error) {
        showNotification("‚ùå Couldn't fetch weather data. Please try again later.");
      } finally {
        loadingSpinner.style.display = 'none';
        weatherText.style.display = 'inline';
      }
    }

    // Enhanced currency converter with loading state and more options
    async function convertCurrency() {
      const amount = document.getElementById('amount').value;
      const fromCurrency = document.getElementById('from-currency').value;
      const historyDiv = document.getElementById('conversion-history');
      
      if (!amount) {
        showNotification("Please enter an amount to convert");
        return;
      }

      showNotification("Converting currency...");
      
      try {
        const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCurrency}`);
        const data = await response.json();
        const rate = data.rates.GBP;
        const result = (amount * rate).toFixed(2);
        
        // Add to conversion history
        const historyItem = document.createElement('div');
        historyItem.className = 'conversion-item';
        historyItem.innerHTML = `${amount} ${fromCurrency} = ${result} GBP`;
        historyDiv.insertBefore(historyItem, historyDiv.firstChild);

        // Keep only last 5 conversions
        if (historyDiv.children.length > 5) {
          historyDiv.removeChild(historyDiv.lastChild);
        }
        
        Swal.fire({
          title: 'üí∑ Currency Conversion',
          html: `
            <div style="text-align: center">
              <h3>${amount} ${fromCurrency} = ${result} GBP</h3>
              <p>Exchange rate: 1 ${fromCurrency} = ${rate.toFixed(4)} GBP</p>
              <p><small>Last updated: ${new Date().toLocaleString()}</small></p>
            </div>
          `,
          icon: 'success',
          confirmButtonColor: '#1d3557'
        });
      } catch (error) {
        showNotification("‚ùå Couldn't convert currency. Please try again later.");
      }
    }

    // Enhanced tube station data
    const tubeStations = [
      { name: 'Westminster', lat: 51.5014, lng: -0.1246, lines: ['Circle', 'District', 'Jubilee'] },
      { name: 'London Bridge', lat: 51.5055, lng: -0.0754, lines: ['Northern', 'Jubilee'] },
      { name: 'Liverpool Street', lat: 51.5178, lng: -0.0817, lines: ['Central', 'Circle', 'Hammersmith & City', 'Metropolitan'] },
      { name: 'King\'s Cross St. Pancras', lat: 51.5308, lng: -0.1238, lines: ['Circle', 'Piccadilly', 'Victoria', 'Northern', 'Metropolitan', 'Hammersmith & City'] },
      { name: 'Oxford Circus', lat: 51.5152, lng: -0.1415, lines: ['Bakerloo', 'Central', 'Victoria'] },
      { name: 'Piccadilly Circus', lat: 51.5098, lng: -0.1342, lines: ['Bakerloo', 'Piccadilly'] },
      { name: 'Victoria', lat: 51.4965, lng: -0.1447, lines: ['Victoria', 'Circle', 'District'] },
      { name: 'Baker Street', lat: 51.5226, lng: -0.1571, lines: ['Bakerloo', 'Circle', 'Hammersmith & City', 'Jubilee', 'Metropolitan'] },
      { name: 'Waterloo', lat: 51.5036, lng: -0.1143, lines: ['Bakerloo', 'Jubilee', 'Northern', 'Waterloo & City'] },
      { name: 'Bank', lat: 51.5133, lng: -0.0886, lines: ['Central', 'Northern', 'Waterloo & City', 'DLR'] },
      { name: 'South Kensington', lat: 51.4941, lng: -0.1738,
        lines: ['Circle', 'District', 'Piccadilly'],
        status: { District: 'Good Service', Circle: 'Good Service', Piccadilly: 'Good Service' }
      },
      { name: 'Earl\'s Court', lat: 51.4915, lng: -0.1973,
        lines: ['District', 'Piccadilly'],
        status: { District: 'Good Service', Piccadilly: 'Good Service' }
      }
    ];

    // Initialize map with enhanced features
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const places = [
      { 
        name: 'Tower Bridge',
        lat: 51.5055,
        lng: -0.0754,
        type: 'landmark',
        description: 'Iconic Victorian bridge',
        image: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad',
        waitTime: '15-20',
        openNow: true,
        price: '¬£10.60',
        bestTime: '9:00 AM'
      },
      {
        name: 'London Eye',
        lat: 51.5033,
        lng: -0.1195,
        type: 'attraction',
        description: 'Giant observation wheel',
        image: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad',
        waitTime: '45-60',
        openNow: true,
        price: '¬£32.50',
        bestTime: '10:00 AM'
      },
      {
        name: 'Big Ben',
        lat: 51.5007,
        lng: -0.1246,
        type: 'landmark',
        description: 'Famous clock tower',
        image: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad',
        waitTime: '5-10',
        openNow: true,
        price: 'Free',
        bestTime: 'Anytime'
      },
      {
        name: 'Buckingham Palace',
        lat: 51.5014,
        lng: -0.1419,
        type: 'landmark',
        description: 'Royal residence',
        image: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad',
        waitTime: '30-40',
        openNow: true,
        price: '¬£30.00',
        bestTime: '11:00 AM'
      }
    ];

    // Add places markers with enhanced popups
    places.forEach(place => {
      const marker = L.marker([place.lat, place.lng]).addTo(map);
      
      // Create enhanced popup content
      const popupContent = `
        <div class="attraction-popup">
          <img src="${place.image}" alt="${place.name}">
          <h3>${place.name}</h3>
          <p>${place.description}</p>
          <div class="live-info">
            <p>‚è∞ Wait Time: <span class="wait-time">${place.waitTime} mins</span></p>
            <p>üé´ Entry: ${place.price}</p>
            <p>‚ú® Best Time: ${place.bestTime}</p>
            <p>üìç Status: ${place.openNow ? 'üü¢ Open Now' : 'üî¥ Closed'}</p>
          </div>
          <button class="btn" onclick="showAttractionDetails('${place.name}')">
            Learn More
          </button>
        </div>
      `;
      
      marker.bindPopup(popupContent);
    });

    // Enhanced tube status function with real tube lines
    function showTubeStatus() {
      tubeLayer = L.layerGroup().addTo(map);
      
      tubeStations.forEach(station => {
        // Random status for demonstration (replace with real TfL API data)
        const status = Math.random() > 0.8 ? 'Busy' : 'Normal';
        const color = status === 'Normal' ? '#4CAF50' : '#F44336';
        
        const marker = L.circleMarker([station.lat, station.lng], {
          radius: 8,
          fillColor: color,
          color: '#fff',
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8
        });

        const popupContent = `
          <div class="station-popup">
            <h3>${station.name}</h3>
            <p><b>Lines:</b></p>
            ${station.lines.map(line => `
              <div class="tube-line">
                <span>${line}</span>
                <span class="status ${Math.random() > 0.8 ? 'delayed' : 'good'}">
                  ${Math.random() > 0.8 ? 'Minor Delays' : 'Good Service'}
                </span>
              </div>
            `).join('')}
            <p><b>Current Status:</b> ${status}</p>
          </div>
        `;

        marker.bindPopup(popupContent);
        marker.addTo(tubeLayer);
      });

      // Update the brief info
      updateTubeBrief();
    }

    // Function to update tube status brief
    function updateTubeBrief() {
      const tubeBrief = document.getElementById('tube-brief-content');
      const lines = ['Victoria', 'Central', 'Piccadilly', 'Northern'];
      let content = '';
      
      lines.forEach(line => {
        const status = Math.random() > 0.8 ? 'Minor Delays' : 'Good Service';
        content += `
          <div class="tube-line">
            <span>${line}</span>
            <span class="status ${status === 'Good Service' ? 'good' : 'delayed'}">${status}</span>
          </div>
        `;
      });
      
      tubeBrief.innerHTML = content;
    }

    // Function to update London weather
    async function updateLondonWeather() {
      const weatherContent = document.getElementById('london-weather-content');
      const API_KEY = "c6a1a88292591e7ab44a1f43d43a3774";
      
      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&appid=${API_KEY}`);
        const data = await response.json();
        
        const icon = getWeatherIcon(data.weather[0].main);
        const temp = Math.round(data.main.temp);
        const feelsLike = Math.round(data.main.feels_like);
        
        weatherContent.innerHTML = `
          <div class="weather-content">
            <div class="weather-icon">${icon}</div>
            <div>
              <div class="weather-temp">${temp}¬∞C</div>
              <div>${data.weather[0].description}</div>
            </div>
          </div>
          <div class="weather-details">
            <div class="weather-detail">
              <i class="fas fa-temperature-low"></i> Feels: ${feelsLike}¬∞C
            </div>
            <div class="weather-detail">
              <i class="fas fa-tint"></i> ${data.main.humidity}%
            </div>
            <div class="weather-detail">
              <i class="fas fa-wind"></i> ${Math.round(data.wind.speed * 3.6)} km/h
            </div>
            <div class="weather-detail">
              <i class="fas fa-compress-arrows-alt"></i> ${data.main.pressure} hPa
            </div>
          </div>
          <div class="weather-time">
            <i class="far fa-clock"></i> Updated: ${formatTime(data.dt)}
          </div>
          ${data.main.temp <= 5 ? `
            <div class="weather-alert">
              <i class="fas fa-exclamation-triangle"></i> Cold weather alert
            </div>
          ` : ''}
        `;
      } catch (error) {
        weatherContent.innerHTML = 'Weather data unavailable';
      }
    }

    // Function to get weather icon based on condition
    function getWeatherIcon(condition) {
      const icons = {
        'Clear': '‚òÄÔ∏è',
        'Clouds': '‚òÅÔ∏è',
        'Rain': 'üåßÔ∏è',
        'Snow': 'üå®Ô∏è',
        'Thunderstorm': '‚õàÔ∏è',
        'Drizzle': 'üå¶Ô∏è',
        'Mist': 'üå´Ô∏è',
        'default': 'üå§Ô∏è'
      };
      return icons[condition] || icons.default;
    }

    // Function to format time
    function formatTime(timestamp) {
      return new Date(timestamp * 1000).toLocaleTimeString('en-GB', {
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Function to get local weather
    async function getLocalWeather() {
      const weatherContent = document.getElementById('local-weather-content');
      const API_KEY = "c6a1a88292591e7ab44a1f43d43a3774";

      weatherContent.innerHTML = '<div class="loading-animation"></div>';
      
      try {
        // Get user's location
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject);
        });

        const { latitude, longitude } = position.coords;
        
        // Get weather data
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&appid=${API_KEY}`
        );
        const data = await response.json();
        
        const icon = getWeatherIcon(data.weather[0].main);
        const temp = Math.round(data.main.temp);
        const feelsLike = Math.round(data.main.feels_like);
        
        weatherContent.innerHTML = `
          <div class="weather-content">
            <div class="weather-icon">${icon}</div>
            <div>
              <div class="weather-temp">${temp}¬∞C</div>
              <div>${data.weather[0].description}</div>
            </div>
          </div>
          <div class="weather-location">
            <i class="fas fa-map-marker-alt"></i> ${data.name}
          </div>
          <div class="weather-details">
            <div class="weather-detail">
              <i class="fas fa-temperature-low"></i> Feels: ${feelsLike}¬∞C
            </div>
            <div class="weather-detail">
              <i class="fas fa-tint"></i> ${data.main.humidity}%
            </div>
            <div class="weather-detail">
              <i class="fas fa-wind"></i> ${Math.round(data.wind.speed * 3.6)} km/h
            </div>
            <div class="weather-detail">
              <i class="fas fa-sun"></i> UV: ${await getUVIndex(latitude, longitude)}
            </div>
          </div>
          <div class="weather-time">
            <i class="far fa-clock"></i> Updated: ${formatTime(data.dt)}
          </div>
        `;
      } catch (error) {
        weatherContent.innerHTML = `
          <div style="text-align: center;">
            <p>Unable to get weather data</p>
            <button class="btn btn-small" onclick="getLocalWeather()">
              <i class="fas fa-redo"></i> Try Again
            </button>
          </div>
        `;
      }
    }

    // Function to get UV index
    async function getUVIndex(lat, lon) {
      try {
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/uvi?lat=${lat}&lon=${lon}&appid=${API_KEY}`
        );
        const data = await response.json();
        return Math.round(data.value);
      } catch (error) {
        return 'N/A';
      }
    }

    // Function to show restaurants (using TripAdvisor data simulation)
    function showRestaurants() {
      restaurantsLayer = L.layerGroup().addTo(map);
      
      const restaurants = [
        { name: "Gordon Ramsay Restaurant", lat: 51.5032, lng: -0.1916, rating: 4.5, cuisine: "British", price: "¬£¬£¬£¬£" },
        { name: "Sketch", lat: 51.5129, lng: -0.1411, rating: 4.7, cuisine: "French", price: "¬£¬£¬£¬£" },
        { name: "Duck & Waffle", lat: 51.5162, lng: -0.0807, rating: 4.3, cuisine: "British", price: "¬£¬£¬£" },
        { name: "The Clove Club", lat: 51.5271, lng: -0.0799, rating: 4.6, cuisine: "Modern European", price: "¬£¬£¬£¬£" },
        { name: "Dishoom", lat: 51.5129, lng: -0.1277, rating: 4.5, cuisine: "Indian", price: "¬£¬£" }
      ];

      restaurants.forEach(restaurant => {
        const marker = L.marker([restaurant.lat, restaurant.lng], {
          icon: L.divIcon({
            className: 'map-marker restaurant-marker',
            html: 'üçΩÔ∏è',
            iconSize: [30, 30]
          })
        });

        const popupContent = `
          <div class="restaurant-popup">
            <h3>${restaurant.name}</h3>
            <p><span class="tripadvisor-rating">‚òÖ ${restaurant.rating}</span></p>
            <p>Cuisine: ${restaurant.cuisine}</p>
            <p>Price Range: ${restaurant.price}</p>
            <button class="btn" onclick="askExample('Tell me about ${restaurant.name} restaurant')">
              More Info
            </button>
          </div>
        `;

        marker.bindPopup(popupContent);
        marker.addTo(restaurantsLayer);
      });
    }

    // Function to toggle map layers
    function toggleMapLayer(layer) {
      // Remove current layers
      [trafficLayer, tubeLayer, crowdsLayer, restaurantsLayer, hotelsLayer].forEach(l => {
        if (l) map.removeLayer(l);
      });

      currentMapLayer = layer;

      switch(layer) {
        case 'traffic':
          showTrafficLayer();
          break;
        case 'tube':
          showTubeStatus();
          break;
        case 'crowds':
          showCrowdLevels();
          break;
        case 'restaurants':
          showRestaurants();
          break;
        case 'hotels':
          showHotels();
          break;
      }
    }

    // Function to show hotels
    function showHotels() {
      hotelsLayer = L.layerGroup().addTo(map);
      
      const hotels = [
        { name: "The Ritz London", lat: 51.5068, lng: -0.1419, rating: 4.8, price: "¬£¬£¬£¬£" },
        { name: "The Savoy", lat: 51.5108, lng: -0.1198, rating: 4.7, price: "¬£¬£¬£¬£" },
        { name: "Shangri-La The Shard", lat: 51.5045, lng: -0.0865, rating: 4.6, price: "¬£¬£¬£¬£" },
        { name: "The Dorchester", lat: 51.5067, lng: -0.1527, rating: 4.7, price: "¬£¬£¬£¬£" },
        { name: "Rosewood London", lat: 51.5172, lng: -0.1168, rating: 4.6, price: "¬£¬£¬£¬£" }
      ];

      hotels.forEach(hotel => {
        const marker = L.marker([hotel.lat, hotel.lng], {
          icon: L.divIcon({
            className: 'map-marker hotel-marker',
            html: 'üè®',
            iconSize: [30, 30]
          })
        });

        const popupContent = `
          <div class="hotel-popup">
            <h3>${hotel.name}</h3>
            <p><span class="tripadvisor-rating">‚òÖ ${hotel.rating}</span></p>
            <p>Price Range: ${hotel.price}</p>
            <button class="btn" onclick="askExample('Tell me about ${hotel.name}')">
              More Info
            </button>
          </div>
        `;

        marker.bindPopup(popupContent);
        marker.addTo(hotelsLayer);
      });
    }

    // Initialize real-time information
    function initializeRealTimeInfo() {
      updateLondonWeather();
      updateTubeBrief();
      
      // Update every 5 minutes
      setInterval(() => {
        updateLondonWeather();
        updateTubeBrief();
      }, 300000);
    }

    // Call initialization when page loads
    document.addEventListener('DOMContentLoaded', initializeRealTimeInfo);

    // Function to show crowd levels
    function showCrowdLevels() {
      crowdsLayer = L.layerGroup().addTo(map);
      
      places.forEach(place => {
        const radius = 50; // meters
        const crowdLevel = Math.random(); // Simulate random crowd levels
        
        const color = crowdLevel > 0.7 ? '#F44336' : 
                     crowdLevel > 0.4 ? '#FFC107' : '#4CAF50';
        
        L.circle([place.lat, place.lng], {
          radius: radius,
          fillColor: color,
          fillOpacity: 0.3,
          color: color,
          weight: 1
        })
        .bindTooltip(`${place.name}<br>Crowd Level: ${Math.round(crowdLevel * 100)}%`)
        .addTo(crowdsLayer);
      });
    }

    // Center map function
    function centerMap() {
      map.setView([51.5074, -0.1278], 12);
    }

    // Enhanced attraction details with direct Dialogflow integration
    function showAttractionDetails(attraction) {
      const place = places.find(p => p.name === attraction);
      
      Swal.fire({
        title: attraction,
        html: `
          <div style="text-align: left">
            <img src="${place.image}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
            <p><b>üé´ Entry:</b> ${place.price}</p>
            <p><b>‚è∞ Current Wait Time:</b> ${place.waitTime} minutes</p>
            <p><b>‚ú® Best Time to Visit:</b> ${place.bestTime}</p>
            <p><b>üìç Status:</b> ${place.openNow ? 'üü¢ Open Now' : 'üî¥ Closed'}</p>
            <hr>
            <p>What would you like to know?</p>
            <div style="display: grid; gap: 10px; margin-top: 15px;">
              <button onclick="askSpecificQuestion('${attraction}', 'history')" class="btn">üìö History</button>
              <button onclick="askSpecificQuestion('${attraction}', 'tickets')" class="btn">üéüÔ∏è Ticket Info</button>
              <button onclick="askSpecificQuestion('${attraction}', 'directions')" class="btn">üó∫Ô∏è Directions</button>
              <button onclick="askSpecificQuestion('${attraction}', 'tips')" class="btn">üí° Visitor Tips</button>
            </div>
          </div>
        `,
        showCancelButton: true,
        showConfirmButton: false,
        cancelButtonText: 'Close',
        width: 600
      });
    }

    // Function to ask specific questions about attractions
    function askSpecificQuestion(attraction, topic) {
      let question = '';
      switch(topic) {
        case 'history':
          question = `Tell me about the history of ${attraction}`;
          break;
        case 'tickets':
          question = `How can I buy tickets for ${attraction}? What are the prices?`;
          break;
        case 'directions':
          question = `How do I get to ${attraction} using public transport?`;
          break;
        case 'tips':
          question = `What are the best tips for visiting ${attraction}?`;
          break;
      }
      
      askExample(question);
      Swal.close();
    }

    // Enhanced notification system with auto-hide
    function showNotification(message) {
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notification-text');
      notificationText.textContent = message;
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Smooth scroll function
    function scrollToSection(sectionId) {
      document.getElementById(sectionId).scrollIntoView({ 
        behavior: 'smooth' 
      });
    }

    // Enhanced visitor counter animation with easing
    function animateVisitorCount() {
      const counter = document.getElementById('visitors-count');
      let count = 0;
      const target = 19.6;
      const duration = 2000;
      const step = target / (duration / 16);
      
      const timer = setInterval(() => {
        count += step;
        if (count >= target) {
          clearInterval(timer);
          counter.textContent = target + 'M';
        } else {
          counter.textContent = count.toFixed(1) + 'M';
        }
      }, 16);
    }

    // Initialize animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          if (entry.target.id === 'visitors-count') {
            animateVisitorCount();
          }
        }
      });
    });

    observer.observe(document.getElementById('visitors-count'));

    // TripAdvisor Integration
    async function fetchTripAdvisorData() {
      // Simulated TripAdvisor data (replace with actual API call)
      return {
        crowdLevels: {
          'Tower Bridge': 75,
          'London Eye': 85,
          'British Museum': 60,
          'Buckingham Palace': 80
        },
        satisfaction: {
          'Tower Bridge': 4.5,
          'London Eye': 4.3,
          'British Museum': 4.8,
          'Buckingham Palace': 4.6
        },
        priceIndex: {
          'Tower Bridge': 'Medium',
          'London Eye': 'High',
          'British Museum': 'Free',
          'Buckingham Palace': 'High'
        }
      };
    }

    // Show different insights
    async function showInsight(type) {
      const insightContent = document.getElementById('insight-content');
      const data = await fetchTripAdvisorData();
      
      // Update active tab
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      let content = '<div class="insight-grid">';
      
      switch(type) {
        case 'crowd':
          Object.entries(data.crowdLevels).forEach(([place, level]) => {
            const color = level > 80 ? '#F44336' : level > 60 ? '#FFC107' : '#4CAF50';
            content += `
              <div class="insight-item">
                <strong>${place}</strong>
                <div class="progress-bar">
                  <div class="progress" style="width: ${level}%; background: ${color}"></div>
                </div>
                <span>${level}% Busy</span>
              </div>
            `;
          });
          break;
        
        case 'satisfaction':
          Object.entries(data.satisfaction).forEach(([place, rating]) => {
            const stars = '‚≠ê'.repeat(Math.floor(rating));
            content += `
              <div class="insight-item">
                <strong>${place}</strong>
                <div>${stars} ${rating}</div>
                <small>${Math.round((rating - Math.floor(rating)) * 100)}% towards next star</small>
              </div>
            `;
          });
          break;
        
        case 'prices':
          Object.entries(data.priceIndex).forEach(([place, price]) => {
            const priceIcon = price === 'High' ? 'üí∞üí∞üí∞' : price === 'Medium' ? 'üí∞üí∞' : 'üí∞';
            content += `
              <div class="insight-item">
                <strong>${place}</strong>
                <div>${priceIcon}</div>
                <small>${price} Price Range</small>
              </div>
            `;
          });
          break;
      }
      
      content += '</div>';
      insightContent.innerHTML = content;
    }

    // Initialize insights on load
    document.addEventListener('DOMContentLoaded', () => {
      showInsight('crowd');
      initializeRealTimeInfo();
    });

    // Update weather information with sunrise/sunset
    async function updateWeatherInfo() {
      // London weather
      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&appid=${config.OPENWEATHER_API_KEY}`);
        const data = await response.json();
        
        document.getElementById('sunrise-time').textContent = 
          new Date(data.sys.sunrise * 1000).toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });
        document.getElementById('sunset-time').textContent = 
          new Date(data.sys.sunset * 1000).toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });
      } catch (error) {
        console.error('Error fetching London weather:', error);
      }
      
      // Local weather (if location permitted)
      try {
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject);
        });
        
        const { latitude, longitude } = position.coords;
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&appid=${config.OPENWEATHER_API_KEY}`
        );
        const data = await response.json();
        
        document.getElementById('local-sunrise-time').textContent = 
          new Date(data.sys.sunrise * 1000).toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });
        document.getElementById('local-sunset-time').textContent = 
          new Date(data.sys.sunset * 1000).toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit'
          });
      } catch (error) {
        console.error('Error fetching local weather:', error);
      }
    }

    // Initialize weather info on load
    document.addEventListener('DOMContentLoaded', () => {
      updateWeatherInfo();
      showInsight('crowd');
      initializeRealTimeInfo();
      
      // Update weather info every 5 minutes
      setInterval(updateWeatherInfo, 300000);
    });

    // Dialogflow Messenger Observer
    window.addEventListener('dfMessengerLoaded', function () {
      const dfMessenger = document.querySelector('df-messenger');
      const chat = dfMessenger.shadowRoot.querySelector('df-messenger-chat');
      const messages = chat.shadowRoot.querySelectorAll('df-message');

      const observer = new MutationObserver(() => {
        const lastMessage = chat.shadowRoot.querySelectorAll('df-message');
        if (lastMessage.length) {
          console.log("üß† LIVE BOT MESSAGE:", lastMessage[lastMessage.length - 1].textContent);
        }
      });

      observer.observe(chat.shadowRoot, { childList: true, subtree: true });
    });
  </script>
</body>
</html> 
